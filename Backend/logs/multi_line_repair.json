{
  "success": true,
  "final_code": "import random\nimport datetime\n\nclass TodoItem:\n    def __init__(self, title, due_date=None, priority=3):\n        self.title = title\n        self.due_date = due_date  # datetime.date or None\n        self.priority = priority  # 1(high)-5(low)\n        self.done = False\n\n    def mark_done(self):\n        self.done = True\n\n    def __str__(self):\n        due = self.due_date.isoformat() if self.due_date else 'No due'\n        status = 'Done' if self.done else 'Pending'\n        return f\"{self.title} | {due} | P{self.priority} | {status}\"\n\nclass TodoList:\n    def __init__(self):\n        self.items = []  # list of TodoItem\n\n    def add_item(self, item):\n        if not isinstance(item, TodoItem):\n            raise TypeError('item must be TodoItem')\n        self.items.append(item)\n\n    def remove_item(self, index):\n        # remove by index, returns removed item\n        return self.items.pop(index)\n\n    def find_by_title(self, title):\n        return [it for it in self.items if title.lower() in it.title.lower()]\n\n    def upcoming(self, days=7):\n        today = datetime.date.today()\n        end = today + datetime.timedelta(days=days)\n        return [it for it in self.items if it.due_date and today <= it.due_date <= end]\n\n    def mark_all_done(self):\n        for it in self.items:\n            it.mark_done()\n\n    def __str__(self):\n        return '\\n'.join(f\"{i}: {str(it)}\" for i, it in enumerate(self.items))\n\ndef parse_date(s):\n    # Accepts YYYY-MM-DD or None\n    if not s:\n        return None\n    parts = s.split('-')\n    if len(parts) != 3:\n        raise ValueError('Invalid date format')\n    y, m, d = map(int, parts)\n    return datetime.date(y, m, d)\n\ndef sample_todo_list():\n    tl = TodoList()\n    tl.add_item(TodoItem('Write report', parse_date('2025-12-01'), priority=2))\n    tl.add_item(TodoItem('Buy groceries', None, priority=4))\n    tl.add_item(TodoItem('Read book', parse_date('2025-11-30'), priority=5))\n    tl.add_item(TodoItem('Pay bills', parse_date('2025-11-25'), priority=1))\n    return tl\n\ndef shuffle_priority(todo_list):\n    # Randomly adjust priorities slightly\n    for it in todo_list.items:\n        delta = random.choice([-1, 0, 1])\n        it.priority = max(1, min(5, it.priority + delta))\n\ndef format_report(todo_list):\n    lines = []\n    lines.append('TODO REPORT:')\n    for it in todo_list.items:\n        lines.append(str(it))\n    return '\\n'.join(lines)\n\ndef save_to_file(todo_list, path):\n    with open(path, 'w') as f:\n        f.write(format_report(todo_list))\n\ndef load_from_file(path):\n    items = TodoList()\n    try:\n        with open(path, 'r') as f:\n            for line in f:\n                line = line.strip()\n                if not line:\n                    continue\n                # naive parse: title | due | P# | status\n                parts = line.split('|')\n                title = parts[0].strip()\n                due = parts[1].strip()\n                p = int(parts[2].strip().lstrip('P'))\n                status = parts[3].strip()\n                due_date = None if due == 'No due' else parse_date(due)\n                it = TodoItem(title, due_date, priority=p)\n                if status == 'Done':\n                    it.mark_done()\n                items.add_item(it)\n    except FileNotFoundError:\n        return items\n    return items\n\ndef simple_cli_demo():\n    tl = sample_todo_list()\n    print('Initial list:')\n    print(tl)\n    shuffle_priority(tl)\n    print('\\nAfter shuffle:')\n    print(tl)\n    print('\\nUpcoming (7 days):')\n    for it in tl.upcoming(7):\n        print(it)\n    save_to_file(tl, 'todo.txt')\n\ndef buggy_function_example(n):\n    # This function intentionally has a small bug for demo\n    total = 0\n    for i in range(1, n):\n        total += i\n    # missing return\n\ndef edge_case_handler(values):\n    # returns max value, but has a bug when list is empty\n    if not values:\n        return None\n    m = values[0]\n    for v in values:\n        if v > m:\n            m = v\n    return m\n\ndef main():\n    print('Starting demo...')\n    tl = sample_todo_list()\n    print(format_report(tl))\n    # demonstrate buggy function\n    x = buggy_function_example(10)\n    print('Sum up to 10 is', x)\n    # edge case\n    print('Max of [] is', edge_case_handler([]))\n    # load file (if exists)\n    tl2 = load_from_file('todo.txt')\n    print('\\nLoaded from file:')\n    print(tl2)\n\nif __name__ == '__main__':\n    main()\n\n",
  "iterations": [
    {
      "iteration": 1,
      "error_type": null,
      "line_number": null,
      "error_message": null,
      "selected_patch_id": null,
      "description": "Code executed successfully",
      "status": "fixed",
      "returncode": 0
    }
  ],
  "total_iterations": 1,
  "final_status": "success",
  "reason": "Code successfully repaired and executes without errors"
}